<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cart Page</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link rel="stylesheet" href="./asset/src/output.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com/" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:ital,opsz,wght@0,14..32,100..900;1,14..32,100..900&family=Langar&family=Poppins:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css"
        integrity="sha512-Kc323vGBEqzTmouAECnVceyQqyqdsSiqLQISBL29aUW4U/M7pSPA/gEUZQqv1cwx4OnYxTxve5UMg5GT6L4JJg=="
        crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link rel="stylesheet" href="./asset/src/output.css">
    <link rel="stylesheet" href="./asset/homePage/home.css">

</head>
<body class="bg-gray-900  ">
    <nav id="nav"
     class="fixed top-0 z-50 h-[77px] w-full flex items-center justify-between px-8 bg-[linear-gradient(90deg,#000000_0%,#EF7D2F_50%,#000000_100%)]">
     <!-- anime power_logo -->
     <div class="logo-nav flex items-center">
         <a href="./index.html">
             <img src="./asset/imges/animePower_logo.png" alt="animePower_logo" class="w-[140px]">
         </a>
     </div>
 
     <!-- navbar menu -->
     <div class="nav-menu h-full items-center self-center flex w-fit">
         <ul id="menuList" class="flex h-full items-center w-full gap-4 z-50">
             <!-- home link-->
             <li class="list-nav-menu">
                 <a href="./index.html" rel="noopener noreferrer" id="home-nave">
                     Home
                 </a>
             </li>
             <!-- about link-->
             <li class="list-nav-menu">
                 <a href="./AboutPage/about.html" rel="noopener noreferrer" id="about-nav">
                     About
                 </a>
             </li>
             <!-- contact navbar -->
             <li class="list-nav-menu">
                 <a href="./index.html" id="contact_nav">
                     Contact
                 </a>
             </li>
         </ul>
     </div>
 
     <!-- right icons -->
     <div class="icons-nav w-24 flex h-full items-center justify-between">
         <i class="fa-solid fa-cart-shopping fa-xl "></i>
         <i class="fa-solid fa-user fa-xl"></i>
     </div>
 
     <!-- Burger Menu (Mobile) -->
     <div class="burger_menu">
         <i class="fa-solid fa-bars fa-xl" onclick="toggleMenu()"></i>
     </div>
 
     <!-- Profile Dropdown -->
     <div class="dropDown-menu-right z-40 rounded-bl-lg rounded-br-lg flex flex-col align-middle items-center absolute right-1 top-[77px] hidden bg-[linear-gradient(90deg,#010101_0%,#676767_100%)]">
         <a href="./login-page/login.html" target="_blank" rel="noopener noreferrer" id="log-in">log-in</a>
         <a href="./signUp.html" target="_blank" rel="noopener noreferrer" id="sign-Up">sign-Up</a>
         <a href="./profile/profile.html" target="_blank" rel="noopener noreferrer">profile</a>
     </div>
 </nav>

    <!-- Table pour les produits dans le panier -->
    <div class="bg-gray-900 p-6 rounded-lg shadow-md mt-10">
        <table class="min-w-full text-left table-fixed border-collapse text-white border-spacing-4">
            <thead>
                <tr class=" border rounded-lg border-gray-400 bg-gray-700  mb-1.5">
                    <th class="px-4 py-2">
                        <input type="checkbox" id="selectAll" onclick="toggleSelectAll()"> <!-- Case pour sélectionner tous les produits -->
                    </th>
                    <th class="px-4 py-2">Produit</th>
                    <th class="px-4 py-2">Prix Unité</th>
                    <th class="px-4 py-2">Quantité</th>
                    <th class="px-4 py-2">Prix Total</th>
                </tr>
            </thead>
            <tbody id="cartItems">
                <!-- Les lignes du tableau seront générées ici via JavaScript -->
            </tbody>
        </table>
        
        <!-- Boutons sous le tableau -->
        <div class="flex justify-between mt-4">
            <button class="bg-blue-500 text-white px-4 py-2 rounded" onclick="returnToShop()">Return to Shop</button>
            <button class="bg-red-500 text-white px-4 py-2 rounded" onclick="removeSelectedItems()">Remove Selected</button>
        </div>
    </div>

    <!-- Tableau pour le total du panier -->
    <div class="bg-gray-500 p-6 mt-6 rounded-lg shadow-md w-2/5  mx-auto mb-[320px]">
        <h2 class="text-lg font-semibold  ">Cart Total</h2>
        <table class="w-full mt-4 text-left">
            <tr class="border-b border-solid border-white border-b-1">
                <td class="font-medium">Subtotal:</td>
                <td id="subtotal" class="text-right">0.00DH</td>
            </tr>
            <tr class="border-b border-solid border-white border-b-1">
                <td class="font-medium">Shipping:</td>
                <td class="text-right">Free</td>
            </tr>
            <tr >
                <td class="font-bold">Total:</td>
                <td id="totalPrice" class="font-bold text-right">0.00DH</td>
            </tr>
        </table>
        
        <!-- Bouton pour finaliser l'achat -->
        <div class="flex justify-center items-center" >
            <button class="bg-gradient-to-r from-orange-500 to-gray-600 text-white font-medium py-2 px-4 rounded-lg " onclick="processCheckout()">Process to Checkout</button>
        </div>
    </div>
    <footer class="flex flex-col bg-[linear-gradient(90deg,#000000_0%,#3B332E_25%,#483F39_50%,#3B332E_75%,#000000_100%)] h-auto">
        <div class="up-footer flex flex-col md:flex-row justify-between px-4 md:px-12 py-6 md:h-[122px]">
            <!-- footer logo -->
            <div class="logo-footer flex items-center justify-center md:justify-start">
                <a href="./index.html">
                    <img src="./asset/imges/animePower_logo.png" alt="animePower_logo" class="w-[140px]">
                </a>
            </div>
    
            <!-- footer links -->
            <div class="footer-links flex flex-col md:flex-row items-center mt-6 md:mt-0">
                <ul class="flex flex-col md:flex-row gap-4">
                    <li class="font-bold text-[#EF7D2F] text-xl pr-3 border-b-2 md:border-b-0 md:border-r-2">
                        Links
                    </li>
                    <li class="list-footer-menu">
                        <a href="./index.html" rel="noopener noreferrer">Home</a>
                    </li>
                    <li class="list-footer-menu">
                        <a href="./AboutPage/about.html" rel="noopener noreferrer">About</a>
                    </li>
                    <li class="list-footer-menu">
                        <a href="./index.html">Contact</a>
                    </li>
                </ul>
            </div>
    
            <!-- follow section -->
            <div class="follow flex flex-col items-center md:items-start mt-6 md:mt-0">
                <p class="text-[#EF7D2F] text-xl">Follow Us!</p>
                <hr class="w-11/12 mt-2 md:w-full">
                <div class="footer-icons flex items-center justify-center md:justify-start pt-4 gap-4 h-9">
                    <i class="fa-brands fa-discord fa-xl"></i>
                    <i class="fa-brands fa-github fa-xl"></i>
                    <i class="fa-brands fa-facebook fa-xl"></i>
                    <i class="fa-brands fa-twitter fa-xl"></i>
                </div>
            </div>
        </div>
    
        <!-- down-footer -->
        <div class="down-footer flex justify-center items-center pt-4 gap-1 border-t-2">
            <i class="fa-regular fa-copyright"></i>
            <p class="text-sm">Copyright <span>Anime power</span> 2024. All rights reserved</p>
        </div>
    </footer>

    <script>
        // Récupérer les produits du panier depuis le localStorage
        let cartItems = JSON.parse(localStorage.getItem('cart')) || [];

        // Fonction de rendu du panier
        function renderCart() {
            const cartItemsTable = document.getElementById("cartItems");
            cartItemsTable.innerHTML = ''; // Clear current cart content
    
            // Check if cart is empty
            if (cartItems.length === 0) {
                cartItemsTable.innerHTML = "<tr><td colspan='5' class='text-center text-white'>Your cart is empty!</td></tr>";
            } else {
                let subtotal = 0;
                cartItems.forEach(item => {
                    const total = item.price * item.quantity;
                    subtotal += total;
                    cartItemsTable.innerHTML += `
                    <tr class="border-b border-gray-400">
                        <td class="px-4 py-2"><input type="checkbox" class="itemSelect" data-id="${item.id}"></td>
                        <td class="px-4 py-2">${item.title || item.name }</td>
                        <td class="px-4 py-2">${item.price}DH</td>
                        <td class="px-4 py-2">
                            <input type="number" class="quantity text-zinc-900 font-bold" value="${item.quantity}" data-id="${item.id}" onchange="updateQuantity(${item.id}, this.value)">
                        </td>
                        <td class="px-4 py-2">${total}DH</td>
                    </tr>
                    `;
                });
                // Update the total price and subtotal
                document.getElementById("subtotal").textContent = `${subtotal.toFixed(2)}DH`;
                document.getElementById("totalPrice").textContent = `${subtotal.toFixed(2)}DH`;
            }
        }
    
        // Update item quantity
        function updateQuantity(itemId, quantity) {
            const item = cartItems.find(item => item.id === itemId);
            if (item) {
                item.quantity = quantity;
                // Save the updated cart to localStorage
                localStorage.setItem("cart", JSON.stringify(cartItems));
                renderCart();
            }
        }
    
        // Remove selected items
        function removeSelectedItems() {
            const selectedItems = document.querySelectorAll(".itemSelect:checked");
            const selectedIds = Array.from(selectedItems).map(item => item.getAttribute("data-id"));
    
            cartItems = cartItems.filter(item => !selectedIds.includes(item.id.toString()));
            // Save the updated cart to localStorage
            localStorage.setItem("cart", JSON.stringify(cartItems));
            renderCart();
        }
    
        // Process Checkout
        function processCheckout() {
            alert("Proceeding to checkout...");
        }
    
        // Return to shop
        function returnToShop() {
            window.location.href = './index.html';
        }
    
        // Toggle Select All
        function toggleSelectAll() {
            const selectAllCheckbox = document.getElementById("selectAll");
            const itemCheckboxes = document.querySelectorAll(".itemSelect");
    
            itemCheckboxes.forEach(checkbox => {
                checkbox.checked = selectAllCheckbox.checked;
            });
        }

        // Supprimer les produits sélectionnés
        // Fonction pour supprimer les produits sélectionnés
function removeSelectedItems() {
    const checkboxes = document.querySelectorAll('.remove-checkbox');
    const selectedIndexes = [];

    // Recueillir les indices des produits sélectionnés pour suppression
    checkboxes.forEach(checkbox => {
        if (checkbox.checked) {
            const index = parseInt(checkbox.getAttribute('data-index'));
            selectedIndexes.push(index);
        }
    });

    // Supprimer les produits dans l'ordre inverse des indices pour éviter les décalages
    selectedIndexes.sort((a, b) => b - a).forEach(index => {
        // Retirer le produit du tableau `cartItems`
        cartItems.splice(index, 1);
    });

    // Sauvegarder le tableau mis à jour dans le localStorage
    localStorage.setItem('cart', JSON.stringify(cartItems));

    // Re-rendre le panier pour afficher les changements
    renderCart();
}


        // Finaliser l'achat
        // Finaliser l'achat et rediriger vers la page de checkout
function processCheckout() {
    // Sauvegarder éventuellement les données du panier ou d'autres informations dans le localStorage
    localStorage.setItem('checkoutCart', JSON.stringify(cartItems));

    // Rediriger vers la page de checkout
    window.location.href = 'checkOut.html'; // Redirection vers checkOut.html
}
document.querySelector('.fa-cart-shopping').addEventListener('click', function () {
    window.location.href = 'cart_de_panier.html'; // Redirige l'utilisateur vers cart_de_panier.html
});

        // Initialisation du rendu du panier
        renderCart();
    </script>
    
</body>

</html>
