<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cart Page</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link rel="stylesheet" href="./asset/src/output.css">
</head>
<body class="bg-gray-900 p-6 ">

    <!-- Table pour les produits dans le panier -->
    <div class="bg-gray-900 p-6 rounded-lg shadow-md">
        <table class="min-w-full text-left table-fixed border-collapse text-white border-spacing-4">
            <thead>
                <tr class=" border rounded-lg border-gray-400 bg-gray-700  mb-1.5">
                    <th class="px-4 py-2">
                        <input type="checkbox" id="selectAll" onclick="toggleSelectAll()"> <!-- Case pour sélectionner tous les produits -->
                    </th>
                    <th class="px-4 py-2">Produit</th>
                    <th class="px-4 py-2">Prix Unité</th>
                    <th class="px-4 py-2">Quantité</th>
                    <th class="px-4 py-2">Prix Total</th>
                </tr>
            </thead>
            <tbody id="cartItems">
                <!-- Les lignes du tableau seront générées ici via JavaScript -->
            </tbody>
        </table>
        
        <!-- Boutons sous le tableau -->
        <div class="flex justify-between mt-4">
            <button class="bg-blue-500 text-white px-4 py-2 rounded" onclick="returnToShop()">Return to Shop</button>
            <button class="bg-red-500 text-white px-4 py-2 rounded" onclick="removeSelectedItems()">Remove Selected</button>
        </div>
    </div>

    <!-- Tableau pour le total du panier -->
    <div class="bg-gray-500 p-6 mt-6 rounded-lg shadow-md w-2/5  mx-auto">
        <h2 class="text-lg font-semibold  ">Cart Total</h2>
        <table class="w-full mt-4 text-left">
            <tr class="border-b border-solid border-white border-b-1">
                <td class="font-medium">Subtotal:</td>
                <td id="subtotal" class="text-right">0.00DH</td>
            </tr>
            <tr class="border-b border-solid border-white border-b-1">
                <td class="font-medium">Shipping:</td>
                <td class="text-right">Free</td>
            </tr>
            <tr >
                <td class="font-bold">Total:</td>
                <td id="totalPrice" class="font-bold text-right">0.00DH</td>
            </tr>
        </table>
        
        <!-- Bouton pour finaliser l'achat -->
        <div class="flex justify-center items-center" >
            <button class="bg-gradient-to-r from-orange-500 to-gray-600 text-white font-medium py-2 px-4 rounded-lg " onclick="processCheckout()">Process to Checkout</button>
        </div>
    </div>

    <script>
        // Récupérer les produits du panier depuis le localStorage
        let cartItems = JSON.parse(localStorage.getItem('cart')) || [];

        // Fonction de rendu du panier
        function renderCart() {
    const cartTable = document.getElementById('cartItems');
    cartTable.innerHTML = '';
    let subtotal = 0;

    cartItems.forEach((item, index) => {
        const total = item.unitPrice * item.quantity;
        subtotal += total;

        cartTable.innerHTML += `
            <tr class="border rounded-lg border-gray-400 bg-gray-700  mb-1.5">
                <td class="px-4 py-2">
                    <input type="checkbox" class="remove-checkbox" data-index="${index}">
                </td>
                <td class="px-4 py-2 flex items-center">
                    <img src="${item.image}" alt="${item.name}" class="w-12 h-12 mr-4"> ${item.name}
                </td>
                <td class="px-4 py-2">${item.unitPrice.toFixed(2)}DH</td>
                <td class="px-4 py-2">
                    <button onclick="decreaseQuantity(${index})">-</button>
                    ${item.quantity}
                    <button onclick="increaseQuantity(${index})">+</button>
                </td>
                <td class="px-4 py-2">${total.toFixed(2)}DH</td>
            </tr>
        `;
    });

    // Mettre à jour les totaux
    document.getElementById('subtotal').innerText = `${subtotal.toFixed(2)}DH`;
    document.getElementById('totalPrice').innerText = `${subtotal.toFixed(2)}DH`;
}


        // Augmenter la quantité d'un produit
        function increaseQuantity(index) {
            cartItems[index].quantity++;
            updateCart();
        }

        // Diminuer la quantité d'un produit
        function decreaseQuantity(index) {
            if (cartItems[index].quantity > 1) {
                cartItems[index].quantity--;
                updateCart();
            }
        }

        // Mettre à jour le localStorage après modification
        function updateCart() {
            localStorage.setItem('cart', JSON.stringify(cartItems));
            renderCart();
        }

        // Rediriger vers la page de magasin
        function returnToShop() {
            window.location.href = '/shop';
        }

        // Cocher/décocher tous les produits
        function toggleSelectAll() {
            const checkboxes = document.querySelectorAll('.remove-checkbox');
            const selectAllCheckbox = document.getElementById('selectAll');
            checkboxes.forEach(checkbox => {
                checkbox.checked = selectAllCheckbox.checked;
            });
        }

        // Supprimer les produits sélectionnés
        // Fonction pour supprimer les produits sélectionnés
function removeSelectedItems() {
    const checkboxes = document.querySelectorAll('.remove-checkbox');
    const selectedIndexes = [];

    // Recueillir les indices des produits sélectionnés pour suppression
    checkboxes.forEach(checkbox => {
        if (checkbox.checked) {
            const index = parseInt(checkbox.getAttribute('data-index'));
            selectedIndexes.push(index);
        }
    });

    // Supprimer les produits dans l'ordre inverse des indices pour éviter les décalages
    selectedIndexes.sort((a, b) => b - a).forEach(index => {
        // Retirer le produit du tableau `cartItems`
        cartItems.splice(index, 1);
    });

    // Sauvegarder le tableau mis à jour dans le localStorage
    localStorage.setItem('cart', JSON.stringify(cartItems));

    // Re-rendre le panier pour afficher les changements
    renderCart();
}


        // Finaliser l'achat
        // Finaliser l'achat et rediriger vers la page de checkout
function processCheckout() {
    // Sauvegarder éventuellement les données du panier ou d'autres informations dans le localStorage
    localStorage.setItem('checkoutCart', JSON.stringify(cartItems));

    // Rediriger vers la page de checkout
    window.location.href = 'checkOut.html'; // Redirection vers checkOut.html
}


        // Initialisation du rendu du panier
        renderCart();
    </script>
</body>
</html>
